<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Imsakiyah Pamekasan ‚Äî Ramadhan 1447H</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<style>
  :root{
    --ink:#070E1A;
    --p1:#0B1826;
    --p2:#0F2035;
    --gold:#C8A84B;
    --gold2:#EDD270;
    --orange:#F5A623;
    --border:rgba(200,168,75,0.18);
    --muted:#4A7494;
    --text:#C0D8EE;
  }
  *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

  html,body{
    width:100%;height:100%;
    font-family:'DM Sans',sans-serif;
    background:var(--ink);
    color:var(--text);
    overflow:hidden;
  }
  @media(max-width:640px){
    html,body{overflow:auto}
  }

  /* ‚îÄ‚îÄ‚îÄ GRID LAYOUT ‚îÄ‚îÄ‚îÄ */
  #app{
    width:100vw; height:100vh;
    display:grid;
    grid-template-columns: 2fr 1fr;
    grid-template-rows: 78px 1fr;
    grid-template-areas:
      "hdr hdr"
      "left right";
    gap:8px;
    padding:8px;
  }
  @media(max-width:640px){
    #app{
      height:auto; min-height:100vh;
      grid-template-columns:1fr;
      grid-template-rows:auto;
      grid-template-areas:"hdr" "left" "right";
    }
    #right{min-height:280px}
  }

  /* bg */
  body::before{
    content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
    background:
      radial-gradient(ellipse 55% 40% at 10% 5%,rgba(200,168,75,.07) 0%,transparent 55%),
      radial-gradient(ellipse 40% 35% at 90% 95%,rgba(15,32,53,.8) 0%,transparent 55%);
  }

  /* stars */
  @keyframes tw{0%,100%{opacity:.05}50%{opacity:.5}}
  .star{position:fixed;border-radius:50%;background:#fff;pointer-events:none;z-index:0;
    animation:tw var(--d,3s) ease-in-out infinite;animation-delay:var(--dl,0s)}

  /* card */
  .card{background:var(--p1);border:1px solid var(--border);border-radius:12px;
    position:relative;z-index:1;overflow:hidden;}
  .card::before{content:'';position:absolute;inset:0;pointer-events:none;
    background:linear-gradient(135deg,rgba(200,168,75,.03) 0%,transparent 50%);}

  /* ‚îÄ‚îÄ‚îÄ HEADER (taller) ‚îÄ‚îÄ‚îÄ */
  #hdr{
    grid-area:hdr;
    background:linear-gradient(100deg,#060E1A,#0D1C30,#060E1A);
    border:1px solid var(--border); border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:0 20px;
    position:relative;
    overflow:hidden;
    z-index:1;
    min-height: 78px;
  }
  #hdr::before{content:'';position:absolute;inset:0;
    background:radial-gradient(ellipse 80% 200% at 50% -60%,rgba(200,168,75,.1) 0%,transparent 60%);}
  .dome{position:absolute;bottom:0;left:50%;transform:translateX(-50%);opacity:.06;pointer-events:none}

  /* Fix for clock visibility */
  #clock-time, #clock-date {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* ‚îÄ‚îÄ‚îÄ LEFT (full width table) ‚îÄ‚îÄ‚îÄ */
  #left{
    grid-area:left;
    display:grid;
    grid-template-rows: auto auto 1fr;
    gap:8px;
    overflow:hidden; position:relative;z-index:1;
  }

  /* ‚îÄ‚îÄ‚îÄ RIGHT (calendar now 1/3 of width - half size) ‚îÄ‚îÄ‚îÄ */
  #right{
    grid-area:right;
    display:flex;flex-direction:column;
    overflow:hidden; position:relative;z-index:1;
  }

  /* ‚îÄ‚îÄ countdown ‚îÄ‚îÄ */
  .cd-box{background:rgba(200,168,75,.08);border:1px solid rgba(200,168,75,.22);
    border-radius:10px;min-width:58px;text-align:center;padding:8px 6px;}
  .cd-num{font-family:'Amiri',serif;font-size:2rem;font-weight:700;color:var(--gold2);line-height:1}
  .cd-lbl{font-size:9px;color:var(--muted);margin-top:2px;letter-spacing:.05em;text-transform:uppercase}
  @keyframes pd{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(1.8)}}
  .dot{width:7px;height:7px;border-radius:50%;background:var(--gold2);display:inline-block;animation:pd 2s infinite}

  /* ‚îÄ‚îÄ imsak/buka big ‚îÄ‚îÄ */
  .big-val{font-family:'Amiri',serif;font-size:3.2rem;line-height:1;font-weight:700}

  /* ‚îÄ‚îÄ prayer rows (SMALLER FONT & PADDING) ‚îÄ‚îÄ */
  .pr{
    display:flex;align-items:center;justify-content:space-between;
    padding: 0.1rem 30px;
    border-bottom:1px solid rgba(255,255,255,.04);
    border-left:3px solid transparent;
    transition:background .15s,border-color .15s;
    flex:1;
    font-size:13px;
  }
  .pr:last-child{border-bottom:none}
  .pr.now{background:rgba(200,168,75,.1);border-left-color:var(--gold)}
  .pr-time{font-family:'Amiri',serif;font-size:1.1rem;font-weight:700;color:var(--gold2)}
  .pr .icon { font-size: 1.0rem; width: 24px; text-align: center; }
  .pr .label { font-size: 11px; font-weight: 600; }

  /* ‚îÄ‚îÄ‚îÄ CALENDAR (compact, half size) ‚îÄ‚îÄ‚îÄ */
  .kal-scroll{flex:1;overflow-y:auto;overflow-x:hidden}
  .kal-scroll::-webkit-scrollbar{width:2px}
  .kal-scroll::-webkit-scrollbar-track{background:transparent}
  .kal-scroll::-webkit-scrollbar-thumb{background:#1a3550;border-radius:2px}

  table{width:100%;border-collapse:collapse}
  thead th{
    padding:3px 2px;
    text-align:center;font-size:7px;text-transform:uppercase;
    letter-spacing:.04em;color:var(--muted);font-weight:700;
    border-bottom:1px solid rgba(255,255,255,.07);
    position:sticky;top:0;background:var(--p1);z-index:2;
  }
  thead th:first-child{text-align:left;padding-left:4px}
  tbody td{
    padding:3px 2px;
    text-align:center;font-size:9px;
    border-bottom:1px solid rgba(255,255,255,.03);
  }
  tbody td:first-child{text-align:left;padding-left:4px;font-weight:600}
  tbody tr:last-child td{border-bottom:none}
  .tr-t td{background:rgba(200,168,75,.1)}
  .tr-t td:first-child{color:var(--gold2)}

  /* chips */
  .chip{display:inline-block;font-size:9px;font-weight:600;letter-spacing:.04em;padding:2px 8px;border-radius:20px}
  .cg{background:rgba(200,168,75,.1);color:var(--gold2);border:1px solid rgba(200,168,75,.22)}
  .cb{background:rgba(80,170,255,.1);color:#72c8ff;border:1px solid rgba(80,170,255,.2)}
  .co{background:rgba(255,150,50,.1);color:#ffaa55;border:1px solid rgba(255,150,50,.2)}
  .cr{background:rgba(255,100,100,.1);color:#ff8888;border:1px solid rgba(255,100,100,.2)}

  .slabel{font-size:8.5px;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);font-weight:700}

  /* shimmer */
  @keyframes sh{0%{background-position:-500px 0}100%{background-position:500px 0}}
  .shimmer{background:linear-gradient(90deg,rgba(255,255,255,.03) 25%,rgba(255,255,255,.06) 50%,rgba(255,255,255,.03) 75%);
    background-size:500px 100%;animation:sh 1.3s infinite;border-radius:10px}

  @keyframes fu{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
  .fu{animation:fu .4s ease forwards}

  .btn{background:linear-gradient(135deg,#8a6010,var(--gold2));color:var(--ink);font-weight:700;
    border:none;border-radius:8px;padding:9px 22px;cursor:pointer;font-family:'DM Sans',sans-serif;
    font-size:13px;transition:opacity .2s,transform .12s}
  .btn:hover{opacity:.88;transform:translateY(-1px)}

  /* symmetrical adjustments for top row */
  #top-row .grid.gap-3 { gap: 1.2rem; }
  #top-row .card {
    padding: 1.5rem 0.5rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #top-row .card p { text-align: center; }
  #cd-boxes { justify-content: center; margin-top: 0.75rem; }

  /* header text */
  #hdr .amiri.text-xl { font-size: 1.5rem; }
  #hdr .chip { font-size: 10px; padding: 3px 10px; }

  /* calendar extra small */
  #kal-wrap .px-2 { padding-left: 0.3rem; padding-right: 0.3rem; }
  #kal-wrap .slabel { font-size: 7px; }
  #kal-wrap .text-\[9px\] { font-size: 7px !important; }
  #kal-wrap .border-t p { font-size: 6px; }
</style>
</head>
<body>

<div id="stars"></div>

<div id="app">

  <!-- ‚ïê‚ïê HEADER (tall) ‚ïê‚ïê -->
  <div id="hdr">
    <svg class="dome" width="360" height="78" viewBox="0 0 360 78">
      <path d="M10 78 Q180 -6 350 78" stroke="#C8A84B" stroke-width="1.8" fill="none"/>
      <path d="M65 78 Q180 26 295 78" stroke="#C8A84B" stroke-width="1" fill="none"/>
      <rect x="173" y="10" width="14" height="28" rx="2" fill="#C8A84B" opacity=".8"/>
      <polygon points="180,8 173,20 187,20" fill="#C8A84B" opacity=".8"/>
    </svg>

    <div class="flex items-center gap-3 relative" style="flex: 1;">
      <div style="filter:drop-shadow(0 0 8px rgba(200,168,75,.45));flex-shrink:0">
        <svg width="42" height="42" viewBox="0 0 42 42">
          <circle cx="21" cy="21" r="15" fill="rgba(200,168,75,.12)" stroke="rgba(200,168,75,.45)" stroke-width="1.1"/>
          <circle cx="27" cy="16" r="13" fill="#060E1A"/>
          <circle cx="21" cy="21" r="2.5" fill="#C8A84B"/>
          <polygon points="33,9 34.5,14 39,14 35.5,17 37,22 33,19 29,22 30.5,17 27,14 31.5,14" fill="#EDD270" opacity=".9"/>
        </svg>
      </div>
      <div>
        <p class="amiri text-2xl leading-tight relative" style="color:var(--gold2)">ÿ•ŸÖÿ≥ÿßŸÉŸäÿ© ÿ±ŸÖÿ∂ÿßŸÜ Ÿ°Ÿ§Ÿ§Ÿß Ÿá‚Äç</p>
        <div class="flex gap-2 mt-1.5 flex-wrap">
          <span class="chip cg">üìç Kab. Pamekasan ¬∑ Jawa Timur</span>
          <span id="hijri-chip" class="chip cb hidden"></span>
          <span class="chip cr">1 Ramadhan = 19 Feb 2026</span>
        </div>
      </div>
    </div>

    <p id="hdr-status" class="text-xs relative hidden sm:block" style="color:var(--muted); margin: 0 10px;"></p>

    <!-- CLOCK SECTION - FIXED VISIBILITY -->
    <div class="text-right relative" style="flex-shrink: 0; min-width: 150px;">
      <p id="clock-time" class="amiri text-3xl leading-tight" style="color:var(--gold2); display: block !important;">--:--:--</p>
      <p id="clock-date" class="text-sm mt-1" style="color:var(--muted); display: block !important;">Loading...</p>
    </div>
  </div>

  <!-- ‚ïê‚ïê LEFT (FULL WIDTH TABLE) ‚ïê‚ïê -->
  <div id="left">

    <!-- loaders -->
    <div id="ll" class="space-y-2" style="grid-row:1/-1">
      <div class="shimmer h-20"></div>
      <div class="shimmer h-20"></div>
      <div class="shimmer" style="height:300px"></div>
    </div>

    <!-- ROW 1: countdown + imsak/buka -->
    <div id="top-row" class="hidden fu" style="display:none;grid-row:1">
      <div class="grid gap-3" style="grid-template-columns:1fr 1fr 1fr">

        <!-- countdown -->
        <div class="card p-4 col-span-1" style="display:flex;flex-direction:column;justify-content:center;align-items:center">
          <div class="text-center w-full">
            <div class="flex items-center justify-center gap-1.5 mb-2">
              <span class="dot"></span>
              <span class="slabel">Waktu Berikutnya</span>
            </div>
            <p id="cd-name" class="amiri text-xl font-bold leading-tight" style="color:var(--gold2)"></p>
            <p id="cd-time" class="text-xs mt-1" style="color:var(--muted)"></p>
          </div>
          <div id="cd-boxes" class="flex items-center justify-center gap-1.5 mt-3"></div>
        </div>

        <!-- imsak -->
        <div class="card p-4 text-center flex flex-col items-center justify-center">
          <span class="chip cb mb-2 block">üåë IMSAK</span>
          <p id="imsak-val" class="big-val" style="color:#72c8ff">‚Äî</p>
          <p class="text-xs mt-1.5" style="color:var(--muted)">Sahur berakhir</p>
        </div>

        <!-- buka -->
        <div class="card p-4 text-center flex flex-col items-center justify-center">
          <span class="chip co mb-2 block">üåá BUKA PUASA</span>
          <p id="buka-val" class="big-val" style="color:#ffaa55">‚Äî</p>
          <p class="text-xs mt-1.5" style="color:var(--muted)">Waktu Maghrib</p>
        </div>

      </div>
    </div>

    <!-- ROW 2: jadwal sholat -->
    <div id="sholat-wrap" class="card hidden fu" style="display:none;flex:1;overflow:hidden;display:flex;flex-direction:column">
      <div class="slabel px-4 pt-3 pb-1.5 flex-shrink-0 flex items-center justify-between">
        <span>Jadwal Sholat Hari Ini</span>
        <span id="today-label" class="text-xs" style="color:var(--muted)"></span>
      </div>
      <div id="sholat-list" style="flex:1;display:flex;flex-direction:column;overflow:hidden"></div>
    </div>

  </div><!-- /left -->

  <!-- ‚ïê‚ïê RIGHT (calendar half size) ‚ïê‚ïê -->
  <div id="right">

    <div id="lr" class="shimmer" style="flex:1;min-height:200px"></div>

    <div id="kal-wrap" class="card hidden fu" style="display:none;flex:1;display:flex;flex-direction:column;overflow:hidden">

      <!-- header (extra compact) -->
      <div class="px-1 pt-1 pb-0.5 flex-shrink-0 border-b" style="border-color:rgba(255,255,255,.06)">
        <p class="slabel text-center" style="font-size:6px;">üìÖ Imsakiyah ¬∑ 1447 H</p>
        <p class="text-[7px] text-center mt-0.5" style="color:var(--muted)">1 Ramadhan = 19 Feb ¬∑ <span id="kal-info" style="font-size:6px;"></span></p>
      </div>

      <!-- table with very compact styling -->
      <div class="kal-scroll" id="kal-scroll">
        <table>
          <thead>
            <tr>
              <th style="text-align:left;padding-left:3px">Tgl</th>
              <th style="color:#72c8ff">Ims</th>
              <th>Sub</th>
              <th>Dzu</th>
              <th>Ash</th>
              <th style="color:#ffaa55">Mag</th>
              <th>Isy</th>
            </tr>
          </thead>
          <tbody id="kal-body"></tbody>
        </table>
      </div>

      <div class="px-1 py-0.5 flex-shrink-0 border-t text-center" style="border-color:rgba(255,255,255,.04)">
        <p style="font-size:5px;color:#1a3550">equran.id ¬∑ Kemenag</p>
      </div>
    </div>

  </div><!-- /right -->

  <!-- error -->
  <div id="err" class="hidden" style="grid-column:1/-1;grid-row:2;display:none;align-items:center;justify-content:center;z-index:10">
    <div class="card p-8 text-center">
      <p class="text-4xl mb-3">‚ö†Ô∏è</p>
      <p id="err-msg" class="text-sm mb-4" style="color:var(--muted)"></p>
      <button class="btn" onclick="boot()">üîÑ Coba Lagi</button>
    </div>
  </div>

</div>

<script>
/* Stars */
(function(){
  const c=document.getElementById('stars');
  for(let i=0;i<50;i++){
    const el=document.createElement('div');el.className='star';
    const s=Math.random()*1.4+.3;
    el.style.cssText=`width:${s}px;height:${s}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${2.5+Math.random()*4}s;--dl:${Math.random()*5}s`;
    c.appendChild(el);
  }
})();

const API  = 'https://equran.id/api/v2/imsakiyah';
const PROV = 'Jawa Timur';
const KAB  = 'Kab. Pamekasan';

// 1 Ramadhan 1447H = 19 Februari 2026
const RAMADHAN_START = new Date(2026, 1, 19);

const ROWS=[
  {key:'imsak',  label:'Imsak',  icon:'üåë', c:'#72c8ff'},
  {key:'subuh',  label:'Subuh',  icon:'üåÑ', c:'#9ad0f0'},
  {key:'terbit', label:'Terbit', icon:'üåÖ', c:'#80b8ce'},
  {key:'dhuha',  label:'Dhuha',  icon:'‚òÄÔ∏è',  c:'#a0c4d4'},
  {key:'dzuhur', label:'Dzuhur', icon:'üïõ', c:'#b8d4e4'},
  {key:'ashar',  label:'Ashar',  icon:'üå§Ô∏è', c:'#a8c4d4'},
  {key:'maghrib',label:'Maghrib',icon:'üåá', c:'#ffaa55'},
  {key:'isya',   label:'Isya',   icon:'üåô', c:'#b0cce0'},
];
const CD_KEYS=['imsak','subuh','dzuhur','ashar','maghrib','isya'];
const CD_LBL={imsak:'üåë Imsak',subuh:'üåÑ Subuh',dzuhur:'üïõ Dzuhur',ashar:'üå§Ô∏è Ashar',maghrib:'üåá Maghrib',isya:'üåô Isya'};

const MONTHS=['Jan','Feb','Mar','Apr','Mei','Jun','Jul','Agu','Sep','Okt','Nov','Des'];
const DAYS_ID=['Minggu','Senin','Selasa','Rabu','Kamis','Jumat','Sabtu'];

let imsakData=[], todayEntry=null, cdTimer=null;

function getGregorianDate(ramadhanDay){
  const d = new Date(RAMADHAN_START);
  d.setDate(d.getDate() + (ramadhanDay - 1));
  return d;
}

function fmtShort(d){
  return `${d.getDate()} ${MONTHS[d.getMonth()]}`;
}

function getRamadhanDay(){
  const now = new Date();
  const nowMidnight = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const startMidnight = new Date(RAMADHAN_START.getFullYear(), RAMADHAN_START.getMonth(), RAMADHAN_START.getDate());
  const diff = Math.round((nowMidnight - startMidnight) / 86400000) + 1;
  return diff;
}

async function boot(){
  setStatus('Memuat data equran.id...');
  showLoad(true); hideErr();

  try{
    const data = await postFallback(API, {provinsi:PROV, kabkota:KAB});
    if(!data || data.code!==200) throw new Error(data?.message || 'Data tidak tersedia');
    imsakData = data.data?.imsakiyah || [];
    if(!imsakData.length) throw new Error('Data jadwal kosong untuk Pamekasan');

    if(data.data?.hijriah){
      const ch = document.getElementById('hijri-chip');
      ch.textContent = 'üóìÔ∏è Ramadhan ' + data.data.hijriah + ' H / 2026 M';
      ch.classList.remove('hidden');
    }

    const ramDay = getRamadhanDay();
    todayEntry = imsakData.find(d => d.tanggal === ramDay) || imsakData[0];

    renderImsakBuka();
    renderSholat();
    renderKalender();
    startCountdown();
    showLoad(false);
    setStatus('equran.id ¬∑ Kemenag RI ¬∑ Data valid');
  }catch(e){
    showLoad(false);
    showErr(e.message || 'Gagal memuat data. Periksa koneksi internet.');
    setStatus('‚ö†Ô∏è Gagal memuat');
  }
}

async function postFallback(url, body){
  const opts = {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)};
  const fns = [
    ()=>fetch(url, opts),
    ()=>fetch('https://corsproxy.io/?'+encodeURIComponent(url), {...opts, headers:{...opts.headers,'x-requested-with':'XMLHttpRequest'}}),
    ()=>fetch('https://api.allorigins.win/raw?url='+encodeURIComponent(url), opts),
  ];
  for(const fn of fns){ try{ const r=await fn(); if(r.ok) return await r.json(); }catch(_){} }
  throw new Error('Semua jalur koneksi ke equran.id gagal.');
}

function renderImsakBuka(){
  document.getElementById('imsak-val').textContent = todayEntry?.imsak || '‚Äî';
  document.getElementById('buka-val').textContent  = todayEntry?.maghrib || '‚Äî';

  const ramDay = getRamadhanDay();
  const gregDate = getGregorianDate(ramDay);
  document.getElementById('today-label').textContent =
    `${DAYS_ID[gregDate.getDay()]}, ${fmtShort(gregDate)} ¬∑ Ramadhan ke-${ramDay}`;

  show('top-row'); show('sholat-wrap');
}

function renderSholat(){
  const list = document.getElementById('sholat-list');
  list.innerHTML = ROWS.map(r => `
    <div class="pr" id="pr-${r.key}">
      <div class="flex items-center gap-1.5">
        <span class="icon">${r.icon}</span>
        <span class="label" style="color:${r.c}">${r.label}</span>
      </div>
      <span class="pr-time">${todayEntry?.[r.key] || '‚Äî'}</span>
    </div>`).join('');
}

function renderKalender(){
  const ramDay = getRamadhanDay();
  document.getElementById('kal-info').textContent = imsakData.length + ' hr';

  document.getElementById('kal-body').innerHTML = imsakData.map(e => {
    const isT = e.tanggal === ramDay;
    const gregDate = getGregorianDate(e.tanggal);
    const gregLabel = fmtShort(gregDate);
    return `<tr class="${isT ? 'tr-t' : ''}">
      <td>
        <span class="font-bold">${e.tanggal}</span>
        <span style="color:var(--muted);font-size:7px;margin-left:1px">${gregLabel}</span>
        ${isT ? '<span style="color:var(--gold2);font-size:7px">‚óÄ</span>' : ''}
      </td>
      <td style="color:#72c8ff">${e.imsak||'‚Äî'}</td>
      <td>${e.subuh||'‚Äî'}</td>
      <td>${e.dzuhur||'‚Äî'}</td>
      <td>${e.ashar||'‚Äî'}</td>
      <td style="color:#ffaa55">${e.maghrib||'‚Äî'}</td>
      <td>${e.isya||'‚Äî'}</td>
    </tr>`;
  }).join('');

  show('kal-wrap');

  setTimeout(()=>{
    const row = document.querySelector('.tr-t');
    if(row){
      const scroll = document.getElementById('kal-scroll');
      scroll.scrollTop = row.offsetTop - scroll.offsetHeight/2 + row.offsetHeight/2;
    }
  },300);
}

function startCountdown(){
  if(cdTimer) clearInterval(cdTimer);
  if(!todayEntry) return;

  function tick(){
    const now = new Date();
    const upcoming = CD_KEYS.map(k=>{
      const t = todayEntry[k]; if(!t) return null;
      const[h,m] = t.split(':').map(Number);
      const dt = new Date(now.getFullYear(),now.getMonth(),now.getDate(),h,m,0);
      return dt > now ? {k,dt,t} : null;
    }).filter(Boolean);

    if(!upcoming.length){
      document.getElementById('cd-name').textContent = 'Selesai hari ini';
      document.getElementById('cd-time').textContent = '';
      document.getElementById('cd-boxes').innerHTML = '';
      return;
    }
    const next = upcoming[0];
    document.getElementById('cd-name').textContent = CD_LBL[next.k] || next.k;
    document.getElementById('cd-time').textContent = next.t + ' WIB';

    const diff = Math.floor((next.dt - now) / 1000);
    const h=Math.floor(diff/3600), m=Math.floor((diff%3600)/60), s=diff%60;
    document.getElementById('cd-boxes').innerHTML =
      `<div class="cd-box"><div class="cd-num">${pad(h)}</div><div class="cd-lbl">Jam</div></div>
       <span style="color:var(--muted);padding-bottom:18px;font-size:1.3rem">:</span>
       <div class="cd-box"><div class="cd-num">${pad(m)}</div><div class="cd-lbl">Mnt</div></div>
       <span style="color:var(--muted);padding-bottom:18px;font-size:1.3rem">:</span>
       <div class="cd-box"><div class="cd-num">${pad(s)}</div><div class="cd-lbl">Dtk</div></div>`;

    document.querySelectorAll('.pr').forEach(r=>r.classList.remove('now'));
    document.getElementById('pr-'+next.k)?.classList.add('now');
  }
  tick(); cdTimer = setInterval(tick, 1000);
}

function startClock(){
  if(window._ck) clearInterval(window._ck);
  function tick(){
    const n = new Date();
    const timeEl = document.getElementById('clock-time');
    const dateEl = document.getElementById('clock-date');
    if(timeEl) timeEl.textContent = n.toLocaleTimeString('id-ID',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
    if(dateEl) dateEl.textContent = n.toLocaleDateString('id-ID',{weekday:'short',day:'numeric',month:'short',year:'numeric'});
  }
  tick(); 
  window._ck = setInterval(tick, 1000);
}

function showLoad(v){
  document.getElementById('ll').style.display = v ? '' : 'none';
  document.getElementById('lr').style.display = v ? '' : 'none';
}
function show(id){
  const el = document.getElementById(id);
  el.classList.remove('hidden');
  el.style.display = id==='top-row' ? 'grid' : id==='sholat-wrap' ? 'flex' : id==='kal-wrap' ? 'flex' : '';
}
function showErr(msg){
  document.getElementById('err-msg').textContent = msg;
  const e = document.getElementById('err');
  e.classList.remove('hidden'); e.style.display = 'flex';
}
function hideErr(){
  const e = document.getElementById('err');
  e.classList.add('hidden'); e.style.display = 'none';
}
function setStatus(t){ 
  const el = document.getElementById('hdr-status');
  if(el) el.textContent = t; 
}
function pad(n){ return String(n).padStart(2,'0'); }

// Start everything
startClock();
boot();
</script>
</body>
</html>
